<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MASTER | GLOBAL TRACKING</title>
    <style>
        :root { --user-color: #39ff14; --bg: #050505; }
        body { background: var(--bg); color: #fff; font-family: 'Courier New', monospace; text-align: center; margin: 0; transition: 0.8s; }
        
        .neon-box { 
            border: 2px solid var(--current-color, var(--user-color)); 
            box-shadow: 0 0 20px var(--current-color, var(--user-color)); 
            padding: 25px; margin: 20px auto; width: 85%; max-width: 450px; border-radius: 15px; 
            background: rgba(0,0,0,0.9);
        }

        input { 
            width: 85%; padding: 12px; margin: 10px 0; background: #000; 
            border: 1px solid var(--current-color, var(--user-color)); color: #fff; border-radius: 5px; outline: none;
        }

        .btn { 
            background: transparent; border: 1px solid var(--current-color, var(--user-color)); color: var(--current-color, var(--user-color));
            padding: 10px 20px; cursor: pointer; margin: 5px; border-radius: 5px; font-weight: bold;
        }
        .btn:hover, .active-tab { background: var(--current-color, var(--user-color)) !important; color: #000 !important; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .card { border: 1px solid #333; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px; font-size: 11px; cursor: pointer; }

        #res { background: #000; border: 1px dashed var(--current-color); padding: 15px; margin-top: 15px; text-align: left; display: none; font-size: 11px; color: #0f0; white-space: pre-wrap; }
        
        .log-item { border-bottom: 1px solid #222; padding: 12px; text-align: left; font-size: 11px; }
        .search-tag { color: #ffcc00; font-weight: bold; }
        .login-tag { color: #00ffcc; font-weight: bold; }
    </style>
</head>
<body>

    <div id="login-screen" class="neon-box">
        <h2>SYSTEM LOGIN</h2>
        <input type="text" id="email" placeholder="Email / ID">
        <input type="password" id="pass" placeholder="Password">
        <br><button class="btn" onclick="handleLogin()">ACCESS</button>
    </div>

    <div id="dashboard" class="neon-box" style="display:none;">
        <h2 id="greet-msg">Welcome</h2>
        
        <div id="owner-controls" style="display:none; margin-bottom:20px;">
            <button id="t1" class="btn active-tab" onclick="switchTab('tools')">üõ† TOOLS</button>
            <button id="t2" class="btn" onclick="switchTab('logs')">üìú HISTORY</button>
        </div>

        <div id="tools-view">
            <input type="text" id="target" placeholder="Enter target data...">
            <div class="grid">
                <div class="card" onclick="triggerAPI('mobile', 'number')">üì± MOBILE</div>
                <div class="card" onclick="triggerAPI('ip', 'ip')">üåê IP TRACK</div>
                <div class="card" onclick="triggerAPI('upi', 'id')">üí∏ UPI</div>
                <div class="card" onclick="triggerAPI('instagram', 'username')">üì∏ INSTA</div>
            </div>
            <div id="res"></div>
        </div>

        <div id="log-view" style="display:none;">
            <h3 style="margin:0;">GLOBAL HISTORY LOGS</h3>
            <div id="log-list">Syncing with Cloud...</div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAyyQVzk9Z0pMEzcc0iNHn-aOAn73-IZ-A",
            authDomain: "my-new-project-33f85.firebaseapp.com",
            projectId: "my-new-project-33f85",
            storageBucket: "my-new-project-33f85.firebasestorage.app",
            messagingSenderId: "1092014213129",
            appId: "1:1092014213129:web:29dd21e5beb542c1d590d8"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const colors = ['#00d2ff', '#bc13fe', '#ff0055', '#ffcc00', '#00ffcc'];
        
        // Local storage se user recover karne ke liye logic
        let sessionUser = localStorage.getItem('activeUser') || "Unknown";

        async function handleLogin() {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('pass').value;
            
            let role = "";
            if(email === "admin" && pass === "harsh@786") role = "user";
            else if(email === "harsh48227@gmail.com" && pass === "harsh@1234") role = "owner";
            else return alert("Invalid!");

            sessionUser = email;
            localStorage.setItem('activeUser', email);

            if(role === "owner") {
                document.documentElement.style.setProperty('--current-color', colors[Math.floor(Math.random()*colors.length)]);
            } else {
                document.documentElement.style.setProperty('--current-color', '#39ff14');
            }

            // Device & Battery
            let device = navigator.userAgent.includes("Android") ? "Android" : (navigator.userAgent.includes("iPhone") ? "iPhone" : "PC");
            let battery = "N/A";
            try { const b = await navigator.getBattery(); battery = Math.round(b.level * 100) + "%"; } catch(e){}

            // Log Login globally
            db.collection("all_activity").add({
                type: "LOGIN",
                user: email,
                details: `Logged in from ${device} (Batt: ${battery})`,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                timeStr: new Date().toLocaleString()
            });

            document.getElementById('login-screen').style.display = "none";
            document.getElementById('dashboard').style.display = "block";

            if(role === "owner") {
                document.getElementById('greet-msg').innerText = "Welcome Master, kaise ho aap?";
                document.getElementById('owner-controls').style.display = "block";
                loadLogs();
            } else {
                document.getElementById('greet-msg').innerText = "Welcome " + email;
            }
        }

        async function triggerAPI(endpoint, param) {
            const val = document.getElementById('target').value;
            if(!val) return alert("Value bhariye!");

            const resDiv = document.getElementById('res');
            resDiv.style.display = "block";
            resDiv.innerText = "[+] Fetching Global Data...";

            try {
                const response = await fetch(`https://api.b77bf911.workers.dev/${endpoint}?${param}=${val}`);
                const data = await response.json();
                resDiv.innerText = JSON.stringify(data, null, 2);

                // GLOBAL LOGGING: Yeh owner ko dikhega chahe user kisi bhi browser par ho
                db.collection("all_activity").add({
                    type: "SEARCH",
                    user: sessionUser,
                    details: `Searched ${endpoint.toUpperCase()}: ${val}`,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    timeStr: new Date().toLocaleString()
                });

            } catch(e) { resDiv.innerText = "API Error or Timeout!"; }
        }

        function switchTab(t) {
            document.getElementById('tools-view').style.display = (t === 'tools' ? 'block' : 'none');
            document.getElementById('log-view').style.display = (t === 'logs' ? 'block' : 'none');
            document.getElementById('t1').classList.toggle('active-tab', t === 'tools');
            document.getElementById('t2').classList.toggle('active-tab', t === 'logs');
        }

        function loadLogs() {
            // Owner ke History tab mein real-time updates ke liye onSnapshot
            db.collection("all_activity").orderBy("timestamp", "desc").limit(20).onSnapshot(snap => {
                let html = "";
                snap.forEach(doc => {
                    const d = doc.data();
                    const tagClass = d.type === "SEARCH" ? "search-tag" : "login-tag";
                    html += `<div class="log-item">
                        <span class="${tagClass}">[${d.type}]</span> <b>${d.user}</b><br>
                        <span>${d.details}</span><br>
                        <small style="color:#666">${d.timeStr}</small>
                    </div>`;
                });
                document.getElementById('log-list').innerHTML = html;
            });
        }
    </script>
</body>
</html>
